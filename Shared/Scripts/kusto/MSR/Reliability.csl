AnnotatedSessions(startDate=ago(90d), endDate=ago(0d))
| where MSRReportable == 1
| extend month = startofmonth(TimeBucket)
| extend IsInteranlAndCBNotRetryable = case(InternalError> 0 and CBCanRetry == 0, 1, 0)
| summarize min(TimeBucket), sum(SessionCount), sum(InternalError), sum(IsInteranlAndCBNotRetryable) by Infra, month
| extend reliability = 100.0 - (100.0 * (sum_InternalError * 1.0 / sum_SessionCount))
| extend reliabilityCBRetry = 100.0 - (100.0 * (sum_IsInteranlAndCBNotRetryable * 1.0 / sum_SessionCount))